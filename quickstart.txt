# Stacktalk Demo - 5 Minute Quickstart

Get Stacktalk running in 5 minutes and see DSL-driven policy violations in action.

## Step 1: Setup (2 minutes)

```bash
# Create and enter project directory
mkdir stacktalk-demo
cd stacktalk-demo

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Download all files to this directory
# (You should have: main.py, src/*.py modules, rules/*.dsl files, requirements.txt)
# 
# NOTE: This is a template - you need to create the actual implementation files
# based on the modular architecture described in this quickstart

# Install dependencies
pip install -r requirements.txt

# Optional: Setup AI-powered COBOL generation
# Create .env file with your OpenAI API key for enhanced code generation
echo "OPENAI_KEY=your_api_key_here" > .env
```

## Step 2: Verify Installation (30 seconds)

```bash
python main.py --validate
```

You should see:
```
âœ… DSL validation passed! Stacktalk is ready to use.
ğŸ“‹ Loaded rule: NSF Banking Rule
   Variables: 4
   Requirements: 3
ğŸ§  AI COBOL Generation: Available (OPENAI_KEY detected)
```

If you see errors, check that:
- Python 3.10+ is installed: `python --version`
- All modular files are in the correct structure
- Virtual environment is activated
- DSL rule files are present in `rules/` directory

## Step 3: Run Tests (1 minute)

```bash
# Run all tests (unit + integration)
python run_tests.py

# Run unit tests only
python run_tests.py --unit

# Run integration tests only  
python run_tests.py --integration

# Run specific test
python run_tests.py --test tests/unit/test_dsl_parser.py

# Verbose output
python run_tests.py --all --verbose
```

You should see:
```
ğŸ§ª Running Unit Tests...
âœ… All unit tests passed!

ğŸ”— Running Integration Tests...
âœ… All integration tests passed!

ğŸ‰ All tests passed! Stacktalk is ready for production.
```

## Step 4: Run the Demo (1 minute)

```bash
python main.py
```

This will:
1. âœ… Parse DSL rules from `rules/*.dsl` files
2. âœ… Generate graph from DSL rules (variables, requirements, logic)
3. âœ… **Generate AI-powered COBOL** examples using OpenAI (if API key available)
4. âœ… **Parse COBOL code with Tree-sitter CST** into graph (programs, variables, procedures, hierarchical structures)
5. âœ… Connect every code element to applicable DSL rules
6. âœ… Analyze graph for policy violations
7. âœ… Generate HTML report

## Step 5: View Results (1 minute)

### In Terminal

You'll see output like:

```
ğŸ¦ Stacktalk MVP: DSL-Driven Financial Rule Detection
============================================================
ğŸ“‹ Loaded rule: NSF Banking Rule (4 variables, 3 requirements)
ğŸ§  AI COBOL Generation: Enabled (OpenAI GPT-4)
ğŸŒ³ Tree-sitter CST Parser: Enabled (Comprehensive COBOL parsing)
âœ… Generated AI-powered COBOL examples
âœ… Generated graph from DSL rules
âœ… Parsed COBOL code with Tree-sitter CST into graph
âœ… Connected code elements to DSL rules
ğŸ” Analyzing graph for violations...
   âŒ Found 3 violations in violation.cob (AI-generated sophisticated violations)
   âœ… No violations in compliant.cob (AI-generated compliant logic)

ğŸ“Š Graph Statistics: 15 nodes, 12 edges, 50% compliance
âœ… Graph saved: output/graph.json
âœ… Report generated: output/report.html
```

### In Browser

Open `output/report.html` to see:
- Executive summary dashboard
- Detailed violation reports with syntax highlighting
- Graph statistics and compliance metrics
- **AI-generated COBOL** with sophisticated business logic and enterprise patterns
- **Code-to-rule connections** showing which DSL rules apply to each code element
- Audit-ready formatting

## Step 6: Customize Rules (1 minute)

```bash
# Modify NSF rule
vim rules/nsf_rule.dsl

# Run with your changes
python main.py

# View graph data
cat output/graph.json

# Graph shows comprehensive connections:
# - DSL Rule nodes â†’ Variable nodes â†’ Requirement nodes
# - COBOL Program nodes â†’ Variable nodes â†’ Procedure nodes  
# - Code variables connected to DSL rule variables
# - Violations linked to specific code elements and rules
```

## What Stacktalk Detects

**NSF Banking Rule**: NSF events must be logged and fee applied
- âŒ **AI-Generated Violation**: Sophisticated fraud detection bypass, subtle audit trail gaps
- âœ… **AI-Generated Compliant**: Complete NSF handling with enterprise-grade error management

**Dual Approval Rule**: Payments >$10K require two approvers  
- âŒ **AI-Generated Violation**: Complex approval chain manipulation, timing-based exploits
- âœ… **AI-Generated Compliant**: Multi-layer authorization with comprehensive logging

## AI-Powered Code Generation

ğŸ§  **OpenAI Integration** provides:
- **Domain Expertise**: Banking, healthcare, insurance compliance knowledge
- **Sophisticated Logic**: Real-world business scenarios and edge cases
- **Enterprise Patterns**: Proper error handling, logging, and audit trails
- **Intelligent Violations**: Subtle compliance gaps that pass basic testing
- **Context Awareness**: Understanding of regulatory requirements and best practices

## Graph Connectivity

The graph creates **comprehensive connections** between DSL rules and code:

```
DSL Rule "NSF Banking Rule"
â”œâ”€â”€ Variable: NSF-LOG-FLAG
â”œâ”€â”€ Variable: NSF-FEE  
â”œâ”€â”€ Requirement: nsf_logging
â””â”€â”€ Requirement: nsf_fee_application

COBOL Program "WITHDRAWAL-PROCESS"  
â”œâ”€â”€ Variable: NSF-LOG-FLAG â† Connected to DSL rule variable
â”œâ”€â”€ Variable: NSF-FEE â† Connected to DSL rule variable
â”œâ”€â”€ Procedure: PROCESS-NSF â† Connected to DSL requirements
â””â”€â”€ Violation: Missing logging â† Linked to specific requirement
```

**Every code element** is mapped to its corresponding DSL rule components, enabling:
- **Precise violation detection** (know exactly which rule is violated)
- **Impact analysis** (see what code changes affect which rules)
- **Compliance tracing** (track rule compliance across codebase)

## Common Issues

**Missing dependencies**: `pip install pyyaml jinja2 rich openai`

**DSL validation error**: Check YAML syntax in `rules/*.dsl`

**AI generation fails**: 
- Check `.env` file has `OPENAI_KEY=your_api_key_here`
- Verify API key is valid and has credits
- Falls back to template mode automatically

**No violations detected**: Modify DSL file to match your code patterns

## Sales Demo (10 minutes)

**Problem** (2 min): COBOL code drifts from documented policies â†’ audit risk

**AI-Powered Demo** (3 min): 
```bash
vim rules/nsf_rule.dsl  # Modify compliance requirements
python main.py          # Watch AI generate sophisticated COBOL
```

**Results Showcase** (3 min):
- Show AI-generated enterprise-grade NSF handling vs basic templates
- Demonstrate sophisticated compliance violations that pass cursory review
- Highlight domain expertise: fraud detection, audit trails, edge cases

**Close** (2 min): "Ready for AI-powered compliance analysis? Enterprise pilot: $100K with custom DSL"

## Next Steps

**Development**: Add DSL rules â†’ enhance graph analysis â†’ improve reports

**Production**: Handle COPY statements â†’ multiple COBOL dialects â†’ Neo4j integration

**Sales**: Get 3 design partners â†’ customize rules â†’ generate case studies

## Directory Structure

```
stacktalk-demo/
â”œâ”€â”€ main.py                    # Main orchestration script
â”œâ”€â”€ requirements.txt           # Python dependencies
â”œâ”€â”€ .env                       # OpenAI API key (OPENAI_KEY=xxx)
â”œâ”€â”€ .gitignore                 # Excludes .env, output/, examples/
â”œâ”€â”€ src/                       # Source modules
â”‚   â”œâ”€â”€ dsl_parser.py         # DSL rule parsing & validation
â”‚   â”œâ”€â”€ cobol_generator.py    # API-powered COBOL generation
â”‚   â”œâ”€â”€ cobol_cst_parser.py   # Tree-sitter CST-based COBOL parsing
â”‚   â”œâ”€â”€ rule_detector.py      # Rule violation detection
â”‚   â”œâ”€â”€ graph_generator.py    # Graph database operations
â”‚   â””â”€â”€ report_generator.py   # HTML report generation
â”œâ”€â”€ rules/                     # DSL rule definitions
â”‚   â”œâ”€â”€ nsf_rule.dsl          # NSF banking rule
â”‚   â””â”€â”€ dual_approval.dsl     # Dual approval rule
â”œâ”€â”€ examples/                  # Generated COBOL examples (AI-powered)
â”‚   â”œâ”€â”€ compliant.cob         # Enterprise-grade compliant logic
â”‚   â””â”€â”€ violation.cob         # Sophisticated violation scenarios
â””â”€â”€ output/                    # Generated outputs
    â”œâ”€â”€ graph.json            # Graph representation
    â””â”€â”€ report.html           # Compliance report
```

## File Checklist

**Required Files** (create these based on the architecture):
```
âœ… main.py                - Main orchestration script
âœ… src/dsl_parser.py      - DSL rule parsing
âœ… src/cobol_generator.py - COBOL code generation  
âœ… src/cobol_cst_parser.py - Tree-sitter CST-based COBOL parsing
âœ… src/rule_detector.py   - Rule violation detection
âœ… src/graph_generator.py - Graph database operations
âœ… src/report_generator.py - HTML report generation
âœ… rules/nsf_rule.dsl     - NSF banking rule definition
âœ… rules/dual_approval.dsl - Dual approval rule definition
âœ… requirements.txt       - Python dependencies (âœ… exists)
```

**Current Status**: Only `requirements.txt` exists. Create the other files using the modular architecture described above.

## Success Checklist

**Once you create the implementation files:**
- âœ… Run `python main.py` successfully
- âœ… See violations detected from DSL rules  
- âœ… View graph data in `output/graph.json`
- âœ… Modify `rules/*.dsl` files and see changes

**Current Status**: This is a **template/blueprint**. You need to implement the actual code files based on the architecture described.

## Architecture Benefits

âœ… **DSL-Driven**: Rules in YAML, not hardcoded  
âœ… **Graph-Enabled**: Rich data representation with **complete code-to-rule mapping**  
âœ… **AI-Powered**: OpenI-generated enterprise-grade COBOL with domain expertise
âœ… **CST-Parsed**: Tree-sitter-based comprehensive COBOL parsing with hierarchical structure
âœ… **Modular**: Independent components with API integration
âœ… **Business-Friendly**: Non-technical users can modify rules
âœ… **Comprehensive**: Every code element connected to applicable DSL rules
âœ… **Intelligent**: Sophisticated violation detection that passes cursory review

---

**Time to first demo**: 5 minutes  
**Time to customize**: 1 hour  
**Time to close first deal**: 30 days (if you have the network)

Good luck! ğŸš€
